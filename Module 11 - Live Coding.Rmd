---
title: "Module 11: Live Coding"
subtitle: "4/26/2020"
output: html_document
---

## Logistic Regression
The Behavioral Risk Factor Surveillance System (BRFSS) is the nation's premier system of health-related telephone surveys that collect state data about U.S. residents regarding their health-related risk behaviors, chronic health conditions, and use of preventive services. We can use this survey data in order to answer several research questions. The codebook for this exercise can be found here: https://www.cdc.gov/brfss/annual_data/2018/pdf/codebook18_llcp-v2-508.pdf. 
 
For this exercise, let's consider a model that seeks to determine whether the Number of Days Mental Health Not Good and E-cigarette use can predict whether or not someone has health insurance. First, let's start by importing the data and doing some data cleaning.
```{r warning=FALSE, message=FALSE}
install.packages("Hmisc")
library(Hmisc)
library(dplyr)

# use sasxport function to import xpt file
BRFSS <- sasxport.get("BRFSS18.xpt")


# set 'dont know' 'did not answer' to NA. According to codebook, values > 30 are dont know/did not answer
BRFSS <- mutate(BRFSS, menthlth = ifelse(menthlth > 30, NA, menthlth))

# check recode
summary(BRFSS$menthlth)

# set 'dont know' 'did not answer' to NA. According to codebook, values > 3 are dont know/did not answer
BRFSS <- mutate(BRFSS, ecignow = ifelse(ecignow > 3, NA, ecignow))

# check recode
summary(BRFSS$ecignow)

# recode health plan to 1/0
BRFSS <- mutate(BRFSS, hlthpln1 = ifelse(hlthpln1 == 1, 1,
                                         ifelse(hlthpln1 == 2,0, NA)))
# check recode
summary(BRFSS$hlthpln1)

# get freq of variables 
table(BRFSS$menthlth)
table(BRFSS$ecignow)
table(BRFSS$hlthpln1)

```


As we learned in the lecture, in logistic regression, the outcome variable is always categorical, which is why we have chosen a binary variable for our outcome.

### The model
We will use the function glm() to create a logistic regression model. Let's save the results of the model in an object called fit1. As you can see, the dependent variable (outcome), hlthpln1, appears first, while the independent variables (predictors), menthlth & ecignow, appear after the tilde (~). Lastly, we specify the name of our dataset and we need to include the family = binomial option to specify a logit model.
```{r warning=FALSE, message=FALSE}
fit1 <- glm(hlthpln1 ~ menthlth + factor(ecignow), data = BRFSS, family = "binomial")
```


### Interpretation
In order to interpret the logit model, we need to examine our regression object using the summary function and take a look at the estimates. Our interpretation templates are below:

* For continuous predictors, write your interpretation in terms of “A 1-[unit] increase in [predictor variable] causes the log odds of [outcome variable = 1 group] to [increase/decrease] by [coefficient], holding the other independent variables constant”
* For binary/categorical predictors, write your interpretation in terms of “The log odds of [outcome variable = 1 group] between the [predictor variable comparison group] and [predictor variable reference group] is [coefficient]"

Finally, determine whether each predictor is significant by comparing the p-value to alpha, 0.05.

As stated in lecture, the intercept is the log odds when all independent variables = 0. However, in many cases, the intercept coefficient is meaningless, especially in cases where a predictor variable is never 0. Therefore, we will skip the interpretation of the intercept coefficient.


```{r warning=FALSE, message=FALSE}
summary(fit1)
```


**Interpret the slope coefficient for Number of Days Mental Health Not Good:** A 1-day increase in the average number of days mental health is not good causes the log odds of having a health plan to decrease by 0.01208, holding the other independent variables constant.

**Interpret the slope coefficients for E-Cigarette use (using "Every day" as the reference group):**  The log odds of having a health plan between someone who uses e-cigarettes some days and someone who uses e-cigarettes every day is -0.10430, holding the other independent variables constant. The log odds of having a health plan between someone who does not use e-cigarettes at all and someone who uses e-cigarettes every day is -0.02548, holding the other independent variables constant.

**Interpret the p-values:** Since the p-value for "number of days mental health not good" is less than alpha, 0.05, we can conclude that number of days mental health not good is associated with whether or not an individual has a health plan.

